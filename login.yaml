---
- hosts: localhost
  vars_files: 
    - settings.yaml
 
  tasks:
          
  - name: Check Ansible version
    assert:
      that: ansible_version.full >= "2.10.0" 
      fail_msg: "Ansible version >= 2.10 required"
      quiet: true
    
  - name: Install apt packages
    become: true
    apt:
      pkg: 
        - python3-hvac
        - kafkacat
        - python3-openstackclient
        - python3-heatclient
        - python3-manilaclient
      state: present
      update-cache: yes

  - name: Set SSH client config
    copy:
      dest: ~/.ssh/config
      mode: 0600
      content: |
        Host *
          StrictHostKeyChecking accept-new

  - name: Install collections
    command: ansible-galaxy collection install -r requirements.yaml -p collections/

#  - name: Install roles
#    command: ansible-galaxy role install -r requirements.yaml -p roles/

  - name: update inventory
    ini_file:
      path: "{{ lookup('env', 'PWD') }}/hosts"
      section: login
      allow_no_value: true
      option: "localhost ansible_connection=local"
        

